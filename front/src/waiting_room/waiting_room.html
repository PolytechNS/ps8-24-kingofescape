<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Waiting for Player</title>
    <link rel="stylesheet" href="waiting_room.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<header>
    <div id="parameter">
        <button onclick="changePage()" id="buttonParameter"></button>
    </div>
    <div id="notification">
        <button onclick="changePage()" id="buttonNotification"></button>
    </div>
    <div id="banner">
        <div class="flag" id="flag1"></div>
        <p id="title">KING OF ESCAPE</p>
        <div class="flag" id="flag2"></div>
    </div>
    <div id="login">
        <button onclick="changePage()" id="buttonLogin">LOGIN</button>
    </div>
</header>
<div id="content">
    <div id="textContainer">
        <p id="textWaiting">Waiting for another player...</p>
        <div class="dots">•••</div>
    </div>

    <div id="waitingPicture" style="background-image: url('castle_war.png');"></div>
    <button onclick="changePage()" id="buttonHome">Home</button>
</div>
<script>
    var socket;

    function initiateMultiplayerMatchmaking() {
        console.log('Button clicked, attempting to find a match...');
        if (socket && socket.connected) {
            socket.emit('findMatch');
            console.log('Emitted findMatch event');
        } else {
            console.error('Socket is not initialized or connected.');
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const socketId = localStorage.getItem('socketId');
        socket = io('http://localhost:8000', { query: { id: socketId } });

        socket.on('connect', () => {
            console.log('Socket connected with id:', socket.id);
            localStorage.setItem('socketId', socket.id);
            initiateMultiplayerMatchmaking();
        });

        socket.on('disconnect', () => {
            console.log('Socket disconnected');
        });

        socket.on('waitingForMatch', () => {
            console.log('Received waitingForMatch event');
            document.getElementById('logs').innerHTML += '<p>Received waitingForMatch event</p>';
        });

        socket.on('matchFound', (room) => {
            console.log(`Received matchFound event, joined room: ${room}`);
            document.getElementById('logs').innerHTML += `<p>Match found, joined room: ${room}</p>`;
            document.getElementById('waitingScreen').style.display = 'none';
        });

        socket.on('startGame', (room) => {
            console.log(`Starting game in room: ${room}`);
            changePage('jeu_1v1/jeu_1v1.html');
        });
    });
    console.log(document.cookie);
</script>
<script src="waiting_room.js"></script>
<script src="../changePage.js"></script>
</body>
</html>
